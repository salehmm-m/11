<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ماشین حساب هزینه برق تجهیزات سرمایشی</title>

  <style>
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            flex-wrap: wrap;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 20px;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        .section-title {
            background-color: #e9ecef;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #495057;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"],
        .input-group select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box; /* Include padding in width */
        }
        .input-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 0.85rem;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            transition: background-color 0.3s ease;
            margin-top: 10px; 
        }
        button:hover {
            background-color: #218838;
        }
        .result-box {
            background-color: #eaf7ed;
            border: 1px solid #c3e6cb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .result-box h3 {
            color: #1a5e2b;
            margin-top: 0;
        }
        .result-box p {
            font-size: 1.05rem;
            margin-bottom: 10px;
        }
        .result-box strong {
            color: #007bff;
        }
        .error-message {
            color: #dc3545;
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
        }
        .info-box {
            background-color: #e0f2f7;
            border: 1px solid #b0e0f2;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95rem;
            color: #2a6496;
        }
        .info-box h4 {
            margin-top: 0;
            color: #2a6496;
        }
        #tariffInputArea {
            border: 1px dashed #a0d8f0;
            padding: 15px;
            border-radius: 8px;
            background-color: #f7fbfc;
        }
        #tariffInputArea .tariff-item {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        #tariffInputArea .tariff-item label {
            flex-basis: 100%; /* Label for "پله X" */
            font-weight: bold;
            margin-bottom: 5px;
        }
        #tariffInputArea .tariff-item .kwh-range-inputs {
            display: flex;
            gap: 5px;
            flex-grow: 1; /* Allow to take available space */
            flex-basis: calc(65% - 10px); /* Adjusted width for "from" and "to" */
        }
        #tariffInputArea .tariff-item .kwh-range-inputs input {
            flex-grow: 1;
            width: auto; /* Allow flex to control width */
            text-align: center;
            direction: ltr;
        }
        #tariffInputArea .tariff-item input.tariff-rate {
            flex-grow: 1; 
            font-size: 1.2rem; 
            padding: 14px; 
            text-align: center;
            direction: ltr;
            max-width: 150px; /* Limit width of rate input */
        }
        #tariffInputArea .tariff-item span.unit-rial {
            white-space: nowrap; 
            font-weight: bold;
        }
        #tariffInputArea .tariff-item .kwh-label-part {
            white-space: nowrap;
            font-weight: normal;
            font-size: 0.9rem;
            color: #666;
            margin-left: 5px;
        }
        .add-tariff-btn {
            background-color: #6c757d;
            width: auto;
            padding: 8px 15px;
            margin-top: 10px;
        }
        .add-tariff-btn:hover {
            background-color: #5a6268;
        }
        .remove-tariff-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 0.9rem;
            margin-right: 5px; /* Add some space from inputs */
        }
        .remove-tariff-btn:hover {
            background-color: #c82333;
        }

        /* Mobile specific adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            .input-group input[type="number"],
            .input-group select {
                width: 100%; 
            }
            #tariffInputArea .tariff-item {
                flex-direction: column; 
                align-items: flex-start;
            }
            #tariffInputArea .tariff-item label {
                width: 100%;
                text-align: right;
            }
            #tariffInputArea .tariff-item .kwh-range-inputs,
            #tariffInputArea .tariff-item input.tariff-rate {
                width: 100%;
                max-width: 100%; /* Ensure they take full width */
                box-sizing: border-box;
            }
            #tariffInputArea .tariff-item .kwh-range-inputs {
                justify-content: space-between; /* Spread "از" and "تا" */
            }
            #tariffInputArea .tariff-item .kwh-range-inputs input {
                width: calc(50% - 5px); /* Half width for each */
            }
            #tariffInputArea .tariff-item span.unit-rial {
                align-self: flex-end; /* Align "ریال" to the right */
                margin-top: -5px; /* Adjust spacing */
            }
            .remove-tariff-btn {
                align-self: flex-start; /* Align remove button to left */
                margin-top: 10px;
            }
        }
  </style>

  
</head>
<body>
  <div class="container">
        <h1>ماشین حساب هزینه برق تجهیزات سرمایشی</h1>
        <p style="text-align: center; color: #555;">با این ابزار می‌توانید مصرف و هزینه برق کولر گازی، فن کویل و چیلر را برآورد کنید.</p>

        <div class="section-title">۱. اطلاعات دستگاه</div>
        <div class="input-group">
            <label for="deviceType">نوع دستگاه:</label>
            <select id="deviceType">
                <option value="ac">کولر گازی</option>
                <option value="fanCoil">فن کویل</option>
                <option value="chiller">چیلر</option>
            </select>
        </div>

        <div class="input-group" id="acCapacityGroup">
            <label for="acCapacity">ظرفیت کولر گازی (BTU/hr):</label>
            <input type="number" id="acCapacity" value="12000" min="1">
            <small>برای کولر گازی اسپلیت، معمولاً روی برچسب دستگاه نوشته شده است.</small>
        </div>

        <div class="input-group" id="eerCopGroup">
            <label for="eerCop">ضریب کارایی (EER یا COP):</label>
            <input type="number" id="eerCop" value="10" step="0.1" min="0.1">
            <small>
                برای کولر گازی: **EER (Energy Efficiency Ratio)**. بازه معمول بین 8 تا 15. <br>
                برای چیلر: **COP (Coefficient of Performance)**. بازه معمول بین 2.5 تا 4.5. <br>
                این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.
            </small>
        </div>

        <div class="input-group" id="fanCoilPowerGroup" style="display: none;">
            <label for="fanCoilPower">توان مصرفی فن کویل (وات):</label>
            <input type="number" id="fanCoilPower" value="150" min="1">
            <small>معمولاً بین 50 تا 300 وات برای فن‌های مختلف.</small>
        </div>

        <div class="input-group">
            <label for="dailyHours">میانگین ساعات کارکرد روزانه (ساعت):</label>
            <input type="number" id="dailyHours" value="8" min="0" max="24">
        </div>

        <div class="input-group">
            <label for="annualDays">تعداد روزهای کارکرد در سال:</label>
            <input type="number" id="annualDays" value="90" min="0" max="365">
        </div>

        <div class="section-title">۲. تعریف پله‌های تعرفه برق</div>
        <div class="info-box">
            <h4>نحوه ورود پله‌های مصرفی:</h4>
            <p>لطفاً پله‌های مصرفی را بر اساس قبض برق یا آخرین مصوبات توانیر وارد کنید. هر پله شامل **میزان مصرف از (کیلووات ساعت)** تا **میزان مصرف تا (کیلووات ساعت)** و **نرخ هر کیلووات ساعت (ریال)** است.</p>
            <p>**توجه:** برای آخرین پله، در فیلد "تا" چیزی وارد نکنید؛ آن فیلد به صورت خودکار "بیشتر از" را نمایش می‌دهد. نرخ‌ها را برای هر پله به ترتیب وارد کنید.</p>
        </div>
        <div id="tariffInputArea">
            </div>
        <button type="button" id="addTariffBtn" class="add-tariff-btn">افزودن پله جدید</button>
        <p style="text-align: center; color: #dc3545; margin-top: 15px;">**توجه: هزینه‌های جانبی مانند آبونمان، مالیات و عوارض در این محاسبه لحاظ نشده‌اند.**</p>

        <button type="button" id="calculateBtn">محاسبه هزینه</button>

        <div class="error-message" id="errorMessage"></div>

        <div class="result-box" id="resultBox" style="display: none;">
            <h3>نتایج محاسبه:</h3>
            <p>توان مصرفی تقریبی: <strong id="outputPower"></strong> وات</p>
            <p>مصرف سالیانه تقریبی: <strong id="outputAnnualKWh"></strong> کیلووات ساعت</p>
            <p>مصرف ماهانه تقریبی در ماه‌های فعالیت: <strong id="outputMonthlyKwh"></strong> کیلووات ساعت</p>
            <p>هزینه ماهانه تقریبی (بر اساس پله‌های وارد شده): <strong id="outputMonthlyCost"></strong> ریال</p>
            <p><strong>هزینه کل تقریبی برای <span id="outputAnnualDays"></span> روز کارکرد: <strong id="outputTotalCost"></strong> ریال</strong></p>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
            const deviceType = document.getElementById('deviceType');
            const acCapacityGroup = document.getElementById('acCapacityGroup');
            const eerCopGroup = document.getElementById('eerCopGroup');
            const fanCoilPowerGroup = document.getElementById('fanCoilPowerGroup');
            const tariffInputArea = document.getElementById('tariffInputArea');
            const addTariffBtn = document.getElementById('addTariffBtn');
            const calculateBtn = document.getElementById('calculateBtn'); 

            function toggleDeviceInputs() {
                const selectedType = deviceType.value;
                acCapacityGroup.style.display = 'none';
                eerCopGroup.style.display = 'none';
                fanCoilPowerGroup.style.display = 'none';

                if (selectedType === 'ac') {
                    acCapacityGroup.style.display = 'block';
                    eerCopGroup.style.display = 'block';
                    document.getElementById('eerCop').previousElementSibling.textContent = "ضریب کارایی (EER):";
                    document.querySelector('#eerCopGroup small').innerHTML = 'برای کولر گازی: **EER (Energy Efficiency Ratio)**. بازه معمول بین 8 تا 15. <br>این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.';
                } else if (selectedType === 'chiller') {
                    acCapacityGroup.style.display = 'block'; 
                    document.getElementById('acCapacity').previousElementSibling.textContent = "ظرفیت چیلر (تن تبرید):";
                    document.getElementById('acCapacity').value = "10"; 
                    document.querySelector('#acCapacityGroup small').textContent = 'معمولاً بین 5 تا 100 تن تبرید.';
                    eerCopGroup.style.display = 'block';
                    document.getElementById('eerCop').previousElementSibling.textContent = "ضریب عملکرد (COP):";
                    document.querySelector('#eerCopGroup small').innerHTML = 'برای چیلر: **COP (Coefficient of Performance)**. بازه معمول بین 2.5 تا 4.5. <br>این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.';

                } else if (selectedType === 'fanCoil') {
                    fanCoilPowerGroup.style.display = 'block';
                }
            }

            function addTariffRow(fromVal = '', toVal = '', rateVal = '') {
                const tariffItem = document.createElement('div');
                tariffItem.classList.add('tariff-item');
                const pahllehNumber = tariffInputArea.children.length + 1;
                
                tariffItem.innerHTML = `
                    <label>پله ${pahllehNumber}:</label>
                    <div class="kwh-range-inputs">
                        <input type="number" class="tariff-kwh-from" placeholder="از" min="0" value="${fromVal}">
                        <span> تا </span>
                        <input type="number" class="tariff-kwh-to" placeholder="تا" min="1" value="${toVal}">
                    </div>
                    <input type="number" class="tariff-rate" placeholder="تعرفه" min="0" value="${rateVal}">
                    <span class="unit-rial">ریال</span>
                    <button type="button" class="remove-tariff-btn">حذف</button>
                `;
                tariffInputArea.appendChild(tariffItem);
                updateTierLabels(); // Re-label all tiers
                updateLastTierInput(); // Adjust input for the last tier
                setupRemoveButtons(); // Re-attach listeners for remove buttons
            }

            function setupRemoveButtons() {
                const removeButtons = tariffInputArea.querySelectorAll('.remove-tariff-btn');
                removeButtons.forEach(btn => {
                    btn.onclick = function() {
                        this.closest('.tariff-item').remove();
                        updateTierLabels(); // Re-label after removal
                        updateLastTierInput(); // Adjust last tier after removal
                        setupRemoveButtons(); // Re-attach listeners as buttons might have changed
                    };
                });
            }

            function updateTierLabels() {
                const tariffItems = tariffInputArea.querySelectorAll('.tariff-item');
                tariffItems.forEach((item, index) => {
                    item.querySelector('label').textContent = `پله ${index + 1}:`;
                });
            }

            function updateLastTierInput() {
                const tariffItems = tariffInputArea.querySelectorAll('.tariff-item');
                if (tariffItems.length > 0) {
                    const lastItem = tariffItems[tariffItems.length - 1];
                    const kwhFromInput = lastItem.querySelector('.tariff-kwh-from');
                    const kwhToInput = lastItem.querySelector('.tariff-kwh-to');
                    
                    kwhToInput.placeholder = "بیشتر از";
                    kwhToInput.disabled = true; // Disable "to" input for the last tier
                    kwhToInput.value = ''; // Clear its value

                    // For all other tiers, ensure "from" is enabled and "to" is not disabled
                    tariffItems.forEach((item, index) => {
                        const fromInput = item.querySelector('.tariff-kwh-from');
                        const toInput = item.querySelector('.tariff-kwh-to');
                        if (index !== tariffItems.length - 1) {
                            fromInput.disabled = false;
                            toInput.disabled = false;
                            toInput.placeholder = "تا";
                        }
                    });
                }
            }

            // Initial setup
            toggleDeviceInputs();
            // Add some default tiers for demonstration or to guide the user
            addTariffRow(0, 100, 590); 
            addTariffRow(101, 200, 690);
            addTariffRow(201, 300, 1290);
            addTariffRow(301, 400, 1990);
            addTariffRow(401, 500, 2390);
            addTariffRow(501, '', 3790); // Last tier with blank 'to' and higher rate

            deviceType.addEventListener('change', toggleDeviceInputs);
            addTariffBtn.addEventListener('click', () => addTariffRow()); // Add an empty tier
            calculateBtn.addEventListener('click', calculateCost); 

            setupRemoveButtons(); // Call initially for default rows
            updateLastTierInput(); // Call initially for default rows
        });

        function calculateCost() {
            const deviceType = document.getElementById('deviceType').value;
            const acCapacity = parseFloat(document.getElementById('acCapacity').value);
            const eerCop = parseFloat(document.getElementById('eerCop').value);
            const fanCoilPower = parseFloat(document.getElementById('fanCoilPower').value);
            const dailyHours = parseFloat(document.getElementById('dailyHours').value);
            const annualDays = parseInt(document.getElementById('annualDays').value);
            const errorMessage = document.getElementById('errorMessage');
            const resultBox = document.getElementById('resultBox');

            errorMessage.textContent = ''; 
            resultBox.style.display = 'none'; 

            if (isNaN(dailyHours) || dailyHours < 0 || dailyHours > 24) {
                errorMessage.textContent = "لطفاً ساعات کارکرد روزانه را بین 0 تا 24 وارد کنید.";
                return;
            }
            if (isNaN(annualDays) || annualDays < 0 || annualDays > 365) {
                errorMessage.textContent = "لطفاً تعداد روزهای کارکرد در سال را بین 0 تا 365 وارد کنید.";
                return;
            }

            let powerConsumptionWatts = 0;
            let deviceName = "";

            if (deviceType === 'ac') {
                if (isNaN(acCapacity) || acCapacity <= 0) {
                    errorMessage.textContent = "لطفاً ظرفیت کولر گازی (BTU/hr) را به درستی وارد کنید.";
                    return;
                }
                if (isNaN(eerCop) || eerCop <= 0) {
                    errorMessage.textContent = "لطفاً ضریب EER را به درستی وارد کنید. معمولاً بین 8 تا 15 است.";
                    return;
                }
                powerConsumptionWatts = acCapacity / eerCop;
                deviceName = "کولر گازی";
            } else if (deviceType === 'fanCoil') {
                if (isNaN(fanCoilPower) || fanCoilPower <= 0) {
                    errorMessage.textContent = "لطفاً توان مصرفی فن کویل (وات) را به درستی وارد کنید.";
                    return;
                }
                powerConsumptionWatts = fanCoilPower;
                deviceName = "فن کویل";
            } else if (deviceType === 'chiller') {
                if (isNaN(acCapacity) || acCapacity <= 0) { 
                    errorMessage.textContent = "لطفاً ظرفیت چیلر (تن تبرید) را به درستی وارد کنید.";
                    return;
                }
                if (isNaN(eerCop) || eerCop <= 0) {
                    errorMessage.textContent = "لطفاً ضریب COP را به درستی وارد کنید. معمولاً بین 2.5 تا 4.5 است.";
                    return;
                }
                const capacityBtu = acCapacity * 12000; 
                const eerFromCop = eerCop * 3.412; 
                powerConsumptionWatts = capacityBtu / eerFromCop;
                deviceName = "چیلر";
            }

            const powerConsumptionKw = powerConsumptionWatts / 1000;
            const totalAnnualKwh = powerConsumptionKw * dailyHours * annualDays;

            // --- Tariff Calculation ---
            const tariffItemsElements = document.querySelectorAll('.tariff-item');
            const tariffs = [];
            let isValidTariff = true;

            tariffItemsElements.forEach(item => {
                const kwhFromInput = item.querySelector('.tariff-kwh-from');
                const kwhToInput = item.querySelector('.tariff-kwh-to');
                const rateInput = item.querySelector('.tariff-rate');
                
                let kwhFrom = parseFloat(kwhFromInput.value);
                let kwhTo = parseFloat(kwhToInput.value);
                const rate = parseFloat(rateInput.value);

                if (isNaN(rate) || rate < 0) {
                    isValidTariff = false;
                    return;
                }

                if (kwhToInput.disabled) { // This is the last tier (more than)
                    if (isNaN(kwhFrom) || kwhFrom < 0) {
                        errorMessage.textContent = "لطفاً 'از' برای پله آخر را وارد کنید.";
                        isValidTariff = false;
                        return;
                    }
                    kwhTo = Infinity; // Set 'to' to infinity for the last tier
                } else { // Intermediate tiers
                    if (isNaN(kwhFrom) || kwhFrom < 0 || isNaN(kwhTo) || kwhTo <= 0 || kwhFrom >= kwhTo) {
                        errorMessage.textContent = "لطفاً 'از' و 'تا' هر پله را به درستی وارد کنید (از باید کمتر از تا باشد).";
                        isValidTariff = false;
                        return;
                    }
                }
                tariffs.push({ from: kwhFrom, to: kwhTo, rate: rate });
            });

            if (!isValidTariff || tariffs.length === 0) {
                if (tariffs.length === 0) {
                    errorMessage.textContent = "لطفاً حداقل یک پله تعرفه برق را تعریف کنید.";
                }
                return;
            }

            // Sort tariffs by their 'from' value to ensure correct order
            tariffs.sort((a, b) => a.from - b.from);

            // Validate overlapping or gaps in tiers
            for (let i = 0; i < tariffs.length - 1; i++) {
                if (tariffs[i].to >= tariffs[i+1].from) {
                    errorMessage.textContent = `پله‌های تعرفه همپوشانی دارند یا به درستی مرتب نشده‌اند. پله ${i+1} و ${i+2} را بررسی کنید.`;
                    return;
                }
            }


            const activeMonths = annualDays > 0 ? Math.ceil(annualDays / 30) : 0;
            const monthlyKwh = activeMonths > 0 ? totalAnnualKwh / activeMonths : 0;

            let monthlyCost = 0;
            let consumptionToCalculate = monthlyKwh;

            for (let i = 0; i < tariffs.length; i++) {
                if (consumptionToCalculate <= 0) break;

                const tier = tariffs[i];
                let tierStart = tier.from;
                let tierEnd = tier.to;
                const tierRate = tier.rate;

                // Determine the actual range for this tier based on overall monthly consumption
                let effectiveTierStart = Math.max(tierStart, 0); // Consumption cannot be negative
                let effectiveTierEnd = Math.min(tierEnd, monthlyKwh); // Cannot go beyond total monthly consumption

                // Calculate consumption within this specific tier's range
                let consumptionInThisTier = 0;
                if (effectiveTierEnd > effectiveTierStart) {
                    consumptionInThisTier = effectiveTierEnd - effectiveTierStart;
                }

                // If current consumption is within this tier
                if (monthlyKwh > tierStart) {
                    let actualConsumptionInThisSegment = Math.min(monthlyKwh, tierEnd) - Math.max(0, tierStart);
                    if (actualConsumptionInThisSegment < 0) actualConsumptionInThisSegment = 0; // Prevent negative values

                    // Make sure we only calculate for the part of remaining consumption that falls into this tier
                    let amountToCharge = Math.min(consumptionToCalculate, tierEnd - tierStart);
                    if (tierEnd === Infinity) { // For the last tier
                        amountToCharge = consumptionToCalculate;
                    } else if (tierStart > monthlyKwh) { // If tier starts beyond total consumption
                        amountToCharge = 0;
                    } else if (monthlyKwh < tierEnd && monthlyKwh > tierStart) { // If total consumption ends in this tier
                         amountToCharge = monthlyKwh - tierStart;
                    } else if (monthlyKwh >= tierEnd) { // If total consumption passes this tier
                        amountToCharge = tierEnd - tierStart;
                    }
                    
                    monthlyCost += amountToCharge * tierRate;
                    consumptionToCalculate -= amountToCharge; // Subtract what's charged
                }
            }
            
            const totalEstimatedCostRial = monthlyCost * activeMonths;

            // Display results
            document.getElementById('outputPower').textContent = powerConsumptionWatts.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputAnnualKWh').textContent = totalAnnualKwh.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputMonthlyKwh').textContent = monthlyKwh.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputMonthlyCost').textContent = monthlyCost.toLocaleString();
            document.getElementById('outputAnnualDays').textContent = annualDays.toLocaleString();
            document.getElementById('outputTotalCost').textContent = totalEstimatedCostRial.toLocaleString();
            
            resultBox.style.display = 'block';
        }
  </script>
</body>
</html>
