<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ماشین حساب هزینه برق تجهیزات سرمایشی</title>

  <style>
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            flex-wrap: wrap;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 20px;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        .section-title {
            background-color: #e9ecef;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #495057;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input[type="number"],
        .input-group select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box; /* Include padding in width */
        }
        .input-group input[type="text"] {
             width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box; /* Include padding in width */
            text-align: left; /* For comma separated values */
            direction: ltr; /* Ensure numbers are displayed LTR */
        }
        .input-group small {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 0.85rem;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #218838;
        }
        .result-box {
            background-color: #eaf7ed;
            border: 1px solid #c3e6cb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .result-box h3 {
            color: #1a5e2b;
            margin-top: 0;
        }
        .result-box p {
            font-size: 1.05rem;
            margin-bottom: 10px;
        }
        .result-box strong {
            color: #007bff;
        }
        .error-message {
            color: #dc3545;
            font-weight: bold;
            margin-top: 10px;
            text-align: center;
        }
        .info-box {
            background-color: #e0f2f7;
            border: 1px solid #b0e0f2;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.95rem;
            color: #2a6496;
        }
        .info-box h4 {
            margin-top: 0;
            color: #2a6496;
        }
        #tariffInputArea {
            border: 1px dashed #a0d8f0;
            padding: 15px;
            border-radius: 8px;
            background-color: #f7fbfc;
        }
        #tariffInputArea .input-group label {
            font-weight: normal;
        }
        #tariffInputArea .tariff-item {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        #tariffInputArea .tariff-item label {
            flex-basis: 15%; /* Adjust label width */
            min-width: 60px; /* Minimum width for label */
        }
        #tariffInputArea .tariff-item input.tariff-kwh-limit {
            flex-grow: 1; /* Allow input to grow */
            max-width: 150px; /* Max width for limit input */
            text-align: center;
            direction: ltr;
        }
        #tariffInputArea .tariff-item input.tariff-rate {
            flex-grow: 2; /* Allow rate input to grow more */
            font-size: 1.1rem; /* Make rate input larger */
            padding: 12px; /* Add more padding */
            text-align: center;
            direction: ltr;
        }
        #tariffInputArea .tariff-item span {
            flex-basis: auto;
            white-space: nowrap; /* Keep "ریال" on one line */
        }
        .add-tariff-btn {
            background-color: #6c757d;
            width: auto;
            padding: 8px 15px;
            margin-top: 10px;
        }
        .add-tariff-btn:hover {
            background-color: #5a6268;
        }
        .remove-tariff-btn {
            display: none !important; /* Always hide remove button as per new requirement */
        }
  </style>

  
</head>
<body>
  <div class="container">
        <h1>ماشین حساب هزینه برق تجهیزات سرمایشی</h1>
        <p style="text-align: center; color: #555;">با این ابزار می‌توانید مصرف و هزینه برق کولر گازی، فن کویل و چیلر را برآورد کنید.</p>

        <div class="section-title">۱. اطلاعات دستگاه</div>
        <div class="input-group">
            <label for="deviceType">نوع دستگاه:</label>
            <select id="deviceType">
                <option value="ac">کولر گازی</option>
                <option value="fanCoil">فن کویل</option>
                <option value="chiller">چیلر</option>
            </select>
        </div>

        <div class="input-group" id="acCapacityGroup">
            <label for="acCapacity">ظرفیت کولر گازی (BTU/hr):</label>
            <input type="number" id="acCapacity" value="12000" min="1">
            <small>برای کولر گازی اسپلیت، معمولاً روی برچسب دستگاه نوشته شده است.</small>
        </div>

        <div class="input-group" id="eerCopGroup">
            <label for="eerCop">ضریب کارایی (EER یا COP):</label>
            <input type="number" id="eerCop" value="10" step="0.1" min="0.1">
            <small>
                برای کولر گازی: **EER (Energy Efficiency Ratio)**. بازه معمول بین 8 تا 15. <br>
                برای چیلر: **COP (Coefficient of Performance)**. بازه معمول بین 2.5 تا 4.5. <br>
                این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.
            </small>
        </div>

        <div class="input-group" id="fanCoilPowerGroup" style="display: none;">
            <label for="fanCoilPower">توان مصرفی فن کویل (وات):</label>
            <input type="number" id="fanCoilPower" value="150" min="1">
            <small>معمولاً بین 50 تا 300 وات برای فن‌های مختلف.</small>
        </div>

        <div class="input-group">
            <label for="dailyHours">میانگین ساعات کارکرد روزانه (ساعت):</label>
            <input type="number" id="dailyHours" value="8" min="0" max="24">
        </div>

        <div class="input-group">
            <label for="annualDays">تعداد روزهای کارکرد در سال:</label>
            <input type="number" id="annualDays" value="90" min="0" max="365">
        </div>

        <div class="section-title">۲. تعریف پله‌های تعرفه برق</div>
        <div class="info-box">
            <h4>نحوه ورود پله‌های مصرفی:</h4>
            <p>لطفاً پله‌های مصرفی را بر اساس قبض برق یا آخرین مصوبات توانیر وارد کنید. هر پله شامل **حداکثر مصرف آن پله (کیلووات ساعت)** و **نرخ هر کیلووات ساعت (ریال)** است. برای مثال، اگر پله اول "۰ تا ۱۰۰" کیلووات ساعت با نرخ ۵۹۰ ریال است، عدد ۱۰۰ و ۵۹۰ را وارد کنید.</p>
            <p>**توجه:** آخرین پله نیازی به وارد کردن حداکثر مصرف ندارد (می‌توانید خالی بگذارید یا هر عدد بزرگ دیگر)، فقط نرخ آن را وارد کنید تا به عنوان نرخ برای مصارف بالاتر از پله قبلی در نظر گرفته شود.</p>
        </div>
        <div id="tariffInputArea">
            <div class="tariff-item">
                <label>پله 1:</label>
                <input type="number" class="tariff-kwh-limit" value="100" min="1" disabled>
                <input type="number" class="tariff-rate" value="590" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
            <div class="tariff-item">
                <label>پله 2:</label>
                <input type="number" class="tariff-kwh-limit" value="200" min="1" disabled>
                <input type="number" class="tariff-rate" value="690" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
            <div class="tariff-item">
                <label>پله 3:</label>
                <input type="number" class="tariff-kwh-limit" value="300" min="1" disabled>
                <input type="number" class="tariff-rate" value="1290" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
            <div class="tariff-item">
                <label>پله 4:</label>
                <input type="number" class="tariff-kwh-limit" value="400" min="1" disabled>
                <input type="number" class="tariff-rate" value="1990" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
            <div class="tariff-item">
                <label>پله 5:</label>
                <input type="number" class="tariff-kwh-limit" value="500" min="1" disabled>
                <input type="number" class="tariff-rate" value="2390" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
            <div class="tariff-item">
                <label>پله 6:</label>
                <input type="number" class="tariff-kwh-limit" placeholder="بیش از" disabled>
                <input type="number" class="tariff-rate" value="3790" min="0">
                <span>ریال</span>
                <button type="button" class="remove-tariff-btn">حذف</button>
            </div>
        </div>
        <button type="button" id="addTariffBtn" class="add-tariff-btn">افزودن پله جدید</button>
        <p style="text-align: center; color: #dc3545; margin-top: 15px;">**توجه: هزینه‌های جانبی مانند آبونمان، مالیات و عوارض در این محاسبه لحاظ نشده‌اند.**</p>

        <button type="button" id="calculateBtn">محاسبه هزینه</button>

        <div class="error-message" id="errorMessage"></div>

        <div class="result-box" id="resultBox" style="display: none;">
            <h3>نتایج محاسبه:</h3>
            <p>توان مصرفی تقریبی: <strong id="outputPower"></strong> وات</p>
            <p>مصرف سالیانه تقریبی: <strong id="outputAnnualKWh"></strong> کیلووات ساعت</p>
            <p>مصرف ماهانه تقریبی در ماه‌های فعالیت: <strong id="outputMonthlyKwh"></strong> کیلووات ساعت</p>
            <p>هزینه ماهانه تقریبی (بر اساس پله‌های وارد شده): <strong id="outputMonthlyCost"></strong> ریال</p>
            <p><strong>هزینه کل تقریبی برای <span id="outputAnnualDays"></span> روز کارکرد: <strong id="outputTotalCost"></strong> ریال</strong></p>
        </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
            const deviceType = document.getElementById('deviceType');
            const acCapacityGroup = document.getElementById('acCapacityGroup');
            const eerCopGroup = document.getElementById('eerCopGroup');
            const fanCoilPowerGroup = document.getElementById('fanCoilPowerGroup');
            const tariffInputArea = document.getElementById('tariffInputArea');
            const addTariffBtn = document.getElementById('addTariffBtn');
            const calculateBtn = document.getElementById('calculateBtn'); 

            function toggleDeviceInputs() {
                const selectedType = deviceType.value;
                acCapacityGroup.style.display = 'none';
                eerCopGroup.style.display = 'none';
                fanCoilPowerGroup.style.display = 'none';

                if (selectedType === 'ac') {
                    acCapacityGroup.style.display = 'block';
                    eerCopGroup.style.display = 'block';
                    document.getElementById('eerCop').previousElementSibling.textContent = "ضریب کارایی (EER):";
                    document.querySelector('#eerCopGroup small').innerHTML = 'برای کولر گازی: **EER (Energy Efficiency Ratio)**. بازه معمول بین 8 تا 15. <br>این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.';
                } else if (selectedType === 'chiller') {
                    acCapacityGroup.style.display = 'block'; 
                    document.getElementById('acCapacity').previousElementSibling.textContent = "ظرفیت چیلر (تن تبرید):";
                    document.getElementById('acCapacity').value = "10"; 
                    document.querySelector('#acCapacityGroup small').textContent = 'معمولاً بین 5 تا 100 تن تبرید.';
                    eerCopGroup.style.display = 'block';
                    document.getElementById('eerCop').previousElementSibling.textContent = "ضریب عملکرد (COP):";
                    document.querySelector('#eerCopGroup small').innerHTML = 'برای چیلر: **COP (Coefficient of Performance)**. بازه معمول بین 2.5 تا 4.5. <br>این عدد را از برچسب انرژی دستگاه خود پیدا کنید. هرچه بالاتر باشد، دستگاه کم‌مصرف‌تر است.';

                } else if (selectedType === 'fanCoil') {
                    fanCoilPowerGroup.style.display = 'block';
                }
            }

            function addTariffRow() {
                const tariffItem = document.createElement('div');
                tariffItem.classList.add('tariff-item');
                // New rows should also have their limit input disabled and numbered correctly
                tariffItem.innerHTML = `
                    <label>پله ${tariffInputArea.children.length + 1}:</label>
                    <input type="number" class="tariff-kwh-limit" placeholder="حداکثر kWh" min="1" disabled>
                    <input type="number" class="tariff-rate" placeholder="نرخ ریال" min="0">
                    <span>ریال</span>
                `;
                tariffInputArea.appendChild(tariffItem);
                updateLastTierInput(); // Update the last tier after adding a new one
            }

            function updateTierLabels() {
                const tariffItems = tariffInputArea.querySelectorAll('.tariff-item');
                tariffItems.forEach((item, index) => {
                    item.querySelector('label').textContent = `پله ${index + 1}:`;
                });
            }

            function updateLastTierInput() {
                const tariffLimits = tariffInputArea.querySelectorAll('.tariff-kwh-limit');
                tariffLimits.forEach((input, index) => {
                    if (index === tariffLimits.length - 1) { // Last tier
                        input.placeholder = "بیش از";
                        input.disabled = true; 
                        input.value = ''; // Clear value for the last placeholder
                    } else {
                        input.placeholder = "حداکثر kWh"; // Placeholder for intermediate tiers
                        input.disabled = false;
                    }
                });
            }

            // Initial setup
            toggleDeviceInputs();
            deviceType.addEventListener('change', toggleDeviceInputs);
            addTariffBtn.addEventListener('click', addTariffRow);
            // No need for updateRemoveButtons() now as buttons are always hidden
            updateLastTierInput(); 

            // Attach event listener to the calculate button
            calculateBtn.addEventListener('click', calculateCost); 
        });

        function calculateCost() {
            const deviceType = document.getElementById('deviceType').value;
            const acCapacity = parseFloat(document.getElementById('acCapacity').value);
            const eerCop = parseFloat(document.getElementById('eerCop').value);
            const fanCoilPower = parseFloat(document.getElementById('fanCoilPower').value);
            const dailyHours = parseFloat(document.getElementById('dailyHours').value);
            const annualDays = parseInt(document.getElementById('annualDays').value);
            const errorMessage = document.getElementById('errorMessage');
            const resultBox = document.getElementById('resultBox');

            errorMessage.textContent = ''; 
            resultBox.style.display = 'none'; 

            if (isNaN(dailyHours) || dailyHours < 0 || dailyHours > 24) {
                errorMessage.textContent = "لطفاً ساعات کارکرد روزانه را بین 0 تا 24 وارد کنید.";
                return;
            }
            if (isNaN(annualDays) || annualDays < 0 || annualDays > 365) {
                errorMessage.textContent = "لطفاً تعداد روزهای کارکرد در سال را بین 0 تا 365 وارد کنید.";
                return;
            }

            let powerConsumptionWatts = 0;
            let deviceName = "";

            if (deviceType === 'ac') {
                if (isNaN(acCapacity) || acCapacity <= 0) {
                    errorMessage.textContent = "لطفاً ظرفیت کولر گازی (BTU/hr) را به درستی وارد کنید.";
                    return;
                }
                if (isNaN(eerCop) || eerCop <= 0) {
                    errorMessage.textContent = "لطفاً ضریب EER را به درستی وارد کنید. معمولاً بین 8 تا 15 است.";
                    return;
                }
                powerConsumptionWatts = acCapacity / eerCop;
                deviceName = "کولر گازی";
            } else if (deviceType === 'fanCoil') {
                if (isNaN(fanCoilPower) || fanCoilPower <= 0) {
                    errorMessage.textContent = "لطفاً توان مصرفی فن کویل (وات) را به درستی وارد کنید.";
                    return;
                }
                powerConsumptionWatts = fanCoilPower;
                deviceName = "فن کویل";
            } else if (deviceType === 'chiller') {
                if (isNaN(acCapacity) || acCapacity <= 0) { 
                    errorMessage.textContent = "لطفاً ظرفیت چیلر (تن تبرید) را به درستی وارد کنید.";
                    return;
                }
                if (isNaN(eerCop) || eerCop <= 0) {
                    errorMessage.textContent = "لطفاً ضریب COP را به درستی وارد کنید. معمولاً بین 2.5 تا 4.5 است.";
                    return;
                }
                const capacityBtu = acCapacity * 12000; 
                const eerFromCop = eerCop * 3.412; 
                powerConsumptionWatts = capacityBtu / eerFromCop;
                deviceName = "چیلر";
            }

            const powerConsumptionKw = powerConsumptionWatts / 1000;
            const totalAnnualKwh = powerConsumptionKw * dailyHours * annualDays;

            // --- Tariff Calculation ---
            const tariffItems = document.querySelectorAll('.tariff-item');
            const tariffs = [];
            let isValidTariff = true;
            tariffItems.forEach(item => {
                const kwhLimitInput = item.querySelector('.tariff-kwh-limit');
                const rateInput = item.querySelector('.tariff-rate');
                
                let kwhLimit = parseFloat(kwhLimitInput.value);
                const rate = parseFloat(rateInput.value);

                if (isNaN(rate) || rate < 0) {
                    isValidTariff = false;
                    return;
                }

                // For the last tier, limit is effectively infinity
                if (kwhLimitInput.disabled) { // Check if disabled attribute is set
                    kwhLimit = Infinity;
                } else if (isNaN(kwhLimit) || kwhLimit <= 0) {
                     isValidTariff = false;
                     return;
                }
                tariffs.push({ limit: kwhLimit, rate: rate });
            });

            if (!isValidTariff) {
                errorMessage.textContent = "لطفاً تمامی نرخ‌های تعرفه و حداکثر مصرف پله‌ها را به درستی (اعداد مثبت) وارد کنید.";
                return;
            }

            // Sort tariffs by limit to ensure correct tier calculation
            tariffs.sort((a, b) => a.limit - b.limit);

            const activeMonths = annualDays > 0 ? Math.ceil(annualDays / 30) : 0;
            const monthlyKwh = activeMonths > 0 ? totalAnnualKwh / activeMonths : 0;

            let monthlyCost = 0;
            let remainingKwh = monthlyKwh;
            let prevLimit = 0;

            for (let i = 0; i < tariffs.length; i++) {
                if (remainingKwh <= 0) break;

                const tier = tariffs[i];
                const tierUpperLimit = tier.limit;
                const tierRate = tier.rate;

                let consumptionInThisTier = 0;

                if (tierUpperLimit === Infinity) { // Last tier
                    consumptionInThisTier = remainingKwh;
                } else {
                    // Calculate consumption for the current tier range
                    const tierRange = tierUpperLimit - prevLimit; 
                    if (remainingKwh >= tierRange) {
                        consumptionInThisTier = tierRange;
                    } else {
                        consumptionInThisTier = remainingKwh;
                    }
                }
                
                monthlyCost += consumptionInThisTier * tierRate;
                remainingKwh -= consumptionInThisTier;
                prevLimit = tierUpperLimit; // Update prevLimit for the next tier calculation
            }
            
            const totalEstimatedCostRial = monthlyCost * activeMonths;

            // Display results
            document.getElementById('outputPower').textContent = powerConsumptionWatts.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputAnnualKWh').textContent = totalAnnualKwh.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputMonthlyKwh').textContent = monthlyKwh.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('outputMonthlyCost').textContent = monthlyCost.toLocaleString();
            document.getElementById('outputAnnualDays').textContent = annualDays.toLocaleString();
            document.getElementById('outputTotalCost').textContent = totalEstimatedCostRial.toLocaleString();
            
            resultBox.style.display = 'block';
        }
  </script>
</body>
</html>
